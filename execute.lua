local a=table.concat;local b=select;local c=string.byte;local d=string.sub;local e={'ABC','ABx','ABC','ABC','ABC','ABx','ABC','ABx','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','AsBx','ABC','ABC','ABC','ABC','ABC','ABC','ABC','ABC','AsBx','AsBx','ABC','ABC','ABC','ABx','ABC'}local function f(g,h,i)if i then local j=g/2^(h-1)%2^(i-1-(h-1)+1)return j-j%1 else local k=2^(h-1)if g%(k+k)>=k then return 1 else return 0 end end end;local function l(m)local n=1;local o;local p;local function q()local r=c(m,n,n)n=n+1;return r end;local function s()local t,u,v,w=c(m,n,n+3)n=n+4;return w*16777216+v*65536+u*256+t end;local function x()return s()*4294967296+s()end;local function y()local z,A=s(),s()if z+A==0 then return 0 else return(-2*f(A,32)+1)*2^(f(A,21,31)-1023)*((f(A,1,20)*2^32+z)/2^52+1)end end;local function B(C)local D;if C then D=d(m,n,n+C-1)n=n+C else C=o()if C==0 then return end;D=d(m,n,n+C-1)n=n+C end;return D end;local function E()local F={}local G={}local H={}local I={Instr=F,Const=G,Proto=H,Lines={},Name=B(),FirstL=p(),LastL=p(),Upvals=q(),Args=q(),Vargs=q(),Stack=q()}if I.Name then I.Name=d(I.Name,1,-2)end;for J=1,p()do local K=s()local L=f(K,1,6)local M=e[L+1]local N;if M then N={Enum=L,f(K,7,14)}if M=='ABC'then N[2]=f(K,24,32)N[3]=f(K,15,23)elseif M=='ABx'then N[2]=f(K,15,32)elseif M=='AsBx'then N[2]=f(K,15,32)-131071 end else N=K end;F[J]=N end;for J=1,p()do local M=q()local O;if M==1 then O=q()~=0 elseif M==3 then O=y()elseif M==4 then O=d(B(),1,-2)end;G[J-1]=O end;for J=1,p()do H[J-1]=E()end;do local P=I.Lines;for J=1,p()do P[J]=s()end;for J=1,p()do B()s()s()end;for J=1,p()do B()end end;return I end;do assert(B(4)=="\27Lua","Lua bytecode expected.")assert(q()==0x51,"Only Lua 5.1 is supported.")q()q()local Q=q()local R=q()if Q==4 then p=s elseif Q==8 then p=x else error('Integer size not supported',2)end;if R==4 then o=s elseif R==8 then o=x else error('Sizet size not supported',2)end;assert(B(3)=="\4\8\0","Unsupported bytecode target platform")end;return E()end;local function S(...)return b('#',...),{...}end;local function T(I,U,V)local F=I.Instr;local G=I.Const;local H=I.Proto;local function W(X,Y)local Z=I.Name or'Code'local l=I.Lines[Y]or'?'local X=X:match'^.+:%s*(.+)'or X;error(string.format('%s (%s): %s',Z,l,X),0)end;return function(...)local V=V;local F=F;local G=G;local H=H;local a0,a1=1,-1;local a2,a3={},b('#',...)-1;local a4={}local a5={}local a6=setmetatable({},{__index=a4,__newindex=function(a7,a8,a9)if a8>a1 and a9 then a1=a8 end;a4[a8]=a9 end})local function aa()local F=F;local N,ab,z,A;while true do N=F[a0]ab=N.Enum;a0=a0+1;if ab==0 then a6[N[1]]=a6[N[2]]elseif ab==1 then a6[N[1]]=G[N[2]]elseif ab==2 then a6[N[1]]=N[2]~=0;if N[3]~=0 then a0=a0+1 end elseif ab==3 then local ac=a6;for J=N[1],N[2]do ac[J]=nil end elseif ab==4 then a6[N[1]]=V[N[2]]elseif ab==5 then a6[N[1]]=U[G[N[2]]]elseif ab==6 then local ad=N[3]local ac=a6;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=ac[N[2]][ad]elseif ab==7 then U[G[N[2]]]=a6[N[1]]elseif ab==8 then V[N[2]]=a6[N[1]]elseif ab==9 then local A,ad=N[2],N[3]local ac=a6;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]][A]=ad elseif ab==10 then a6[N[1]]={}elseif ab==11 then local z=N[1]local A=N[2]local ad=N[3]local ac=a6;A=ac[A]if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[z+1]=A;ac[z]=A[ad]elseif ab==12 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A+ad elseif ab==13 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A-ad elseif ab==14 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A*ad elseif ab==15 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A/ad elseif ab==16 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A%ad elseif ab==17 then local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;ac[N[1]]=A^ad elseif ab==18 then a6[N[1]]=-a6[N[2]]elseif ab==19 then a6[N[1]]=not a6[N[2]]elseif ab==20 then a6[N[1]]=#a6[N[2]]elseif ab==21 then local ac=a6;local A=N[2]local af={a6[A]}for J=A+1,N[3]do af[#af+1]=ac[J]end;a6[N[1]]=a(af)elseif ab==22 then a0=a0+N[2]elseif ab==23 then local z=N[1]~=0;local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;if A==ad~=z then a0=a0+1 end elseif ab==24 then local z=N[1]~=0;local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;if A<ad~=z then a0=a0+1 end elseif ab==25 then local z=N[1]~=0;local A=N[2]local ad=N[3]local ac,ae=a6,G;if A>255 then A=G[A-256]else A=ac[A]end;if ad>255 then ad=G[ad-256]else ad=ac[ad]end;if A<=ad~=z then a0=a0+1 end elseif ab==26 then if not not a6[N[1]]==(N[3]==0)then a0=a0+1 end elseif ab==27 then local A=a6[N[2]]if not not A==(N[3]==0)then a0=a0+1 else a6[N[1]]=A end elseif ab==28 then local z=N[1]local A=N[2]local ad=N[3]local ac=a6;local ag,ah;local ai,aa;ag={}if A~=1 then if A~=0 then ai=z+A-1 else ai=a1 end;aa=0;for J=z+1,ai do aa=aa+1;ag[aa]=ac[J]end;ai,ah=S(ac[z](unpack(ag,1,ai-z)))else ai,ah=S(ac[z]())end;a1=z-1;if ad~=1 then if ad~=0 then ai=z+ad-2 else ai=ai+z end;aa=0;for J=z,ai do aa=aa+1;ac[J]=ah[aa]end end elseif ab==29 then local z=N[1]local A=N[2]local ad=N[3]local ac=a6;local ag,ah;local ai,aa;ag={}if A~=1 then if A~=0 then ai=z+A-1 else ai=a1 end;aa=0;for J=z+1,ai do aa=aa+1;ag[#ag+1]=ac[J]end;ah={ac[z](unpack(ag,1,ai-z))}else ah={ac[z]()}end;return ah elseif ab==30 then local z=N[1]local A=N[2]local ac=a6;local aa,aj;local ai;if A==1 then return elseif A==0 then ai=a1 else ai=z+A-2 end;aj={}local aa=0;for J=z,ai do aa=aa+1;aj[aa]=ac[J]end;return aj elseif ab==31 then local z=N[1]local ac=a6;local ak=ac[z+2]local al=ac[z]+ak;ac[z]=al;if ak>0 then if al<=ac[z+1]then a0=a0+N[2]ac[z+3]=al end else if al>=ac[z+1]then a0=a0+N[2]ac[z+3]=al end end elseif ab==32 then local z=N[1]local ac=a6;ac[z]=ac[z]-ac[z+2]a0=a0+N[2]elseif ab==33 then local z=N[1]local A=N[2]local ad=N[3]local ac=a6;local am=z+2;local an={ac[z](ac[z+1],ac[z+2])}for J=1,ad do a6[am+J]=an[J]end;if ac[z+3]~=nil then ac[z+2]=ac[z+3]else a0=a0+1 end elseif ab==34 then local z=N[1]local A=N[2]local ad=N[3]local ac=a6;if ad==0 then a0=a0+1;ad=F[a0]end;local am=(ad-1)*50;local ao=ac[z]if A==0 then A=a1 end;for J=1,A do ao[am+J]=ac[z+J]end elseif ab==35 then local z=N[1]local ap={}for J=1,#a5 do local aq=a5[J]for ar=1,#aq do local as=aq[ar]local ac=as[1]local n=as[2]if ac==a6 and n>=z then ap[n]=ac[n]as[1]=ap end end end elseif ab==36 then local H=H[N[2]]local F=F;local ac=a6;local at;local au;if H.Upvals~=0 then at={}au=setmetatable({},{__index=function(a7,a8)local av=at[a8]return av[1][av[2]]end,__newindex=function(a7,a8,a9)local av=at[a8]av[1][av[2]]=a9 end})for J=1,H.Upvals do local aw=F[a0]if aw.Enum==0 then at[J-1]={ac,aw[2]}elseif aw.Enum==4 then at[J-1]={V,aw[2]}end;a0=a0+1 end;a5[#a5+1]=at end;ac[N[1]]=T(H,U,au)elseif ab==37 then local z=N[1]local A=N[2]local ac,a2=a6,a2;for J=z,z+(A>0 and A-1 or a3)do ac[J]=a2[J-z]end end end end;local ag={...}for J=0,a3 do a6[J]=ag[J+1]if J>=I.Args then a2[J-I.Args]=ag[J+1]end end;local z,A=pcall(aa)if z then if A then return unpack(A)end;return else W(A,a0-1)end end end;return function(ax,U)local ay=l(ax)return T(ay,U),ay end
